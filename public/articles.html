<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Научные статьи</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Шапка (как в предыдущих примерах) -->
  <main class="container">
    <section class="articles-section">
      <h2>Все научные статьи</h2>
      
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Поиск по статьям...">
        <button id="searchBtn">Поиск</button>
      </div>

      <div id="articlesList">
        <!-- Статьи будут загружаться здесь -->
      </div>

      <div id="pagination" class="pagination">
        <button id="prevBtn">Назад</button>
        <span id="pageInfo">Страница 1</span>
        <button id="nextBtn">Вперед</button>
      </div>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    let currentPage = 1;
    const articlesPerPage = 5;

    async function loadArticles() {
      try {
        const searchQuery = document.getElementById('searchInput').value;
        const response = await fetch(
          `${API_BASE}/api/articles?page=${currentPage}&limit=${articlesPerPage}&q=${searchQuery}`
        );
        const data = await response.json();

        if (!response.ok) throw new Error(data.error || 'Ошибка загрузки');

        const articlesList = document.getElementById('articlesList');
        articlesList.innerHTML = '';

        if (data.articles.length === 0) {
          articlesList.innerHTML = '<p class="no-articles">Статьи не найдены</p>';
          return;
        }

        data.articles.forEach(article => {
          const articleEl = document.createElement('article');
          articleEl.className = 'article-card';
          articleEl.innerHTML = `
            <h3><a href="article.html?id=${article.id}">${article.title}</a></h3>
            <p class="meta">Автор: ${article.author} | ${new Date(article.created_at).toLocaleDateString()}</p>
            <p class="abstract">${article.abstract}</p>
            <a href="article.html?id=${article.id}" class="read-more">Читать полностью</a>
            <div class="comments-count">Комментарии: ${article.comments_count || 0}</div>
          `;
          articlesList.appendChild(articleEl);
        });

        // Обновляем пагинацию
        document.getElementById('pageInfo').textContent = `Страница ${currentPage}`;
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = data.articles.length < articlesPerPage;
      } catch (error) {
        console.error('Ошибка:', error);
        document.getElementById('articlesList').innerHTML = `
          <p class="error">Ошибка загрузки статей: ${error.message}</p>
        `;
      }
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', () => {
      loadArticles();

      document.getElementById('searchBtn').addEventListener('click', () => {
        currentPage = 1;
        loadArticles();
      });

      document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          loadArticles();
        }
      });

      document.getElementById('nextBtn').addEventListener('click', () => {
        currentPage++;
        loadArticles();
      });
    });
  </script>
</body>
</html>