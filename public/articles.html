<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Научные статьи | Платформа публикаций</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Платформа научных публикаций</h1>
    <nav>
      <a href="index.html">Главная</a>
      <a href="add_article.html">Добавить статью</a>
      <a href="login.html">Личный кабинет</a>
    </nav>
  </header>
  <main>
    <section class="articles-container">
      <div class="articles-header">
        <h2>Все научные статьи</h2>
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Поиск по статьям...">
          <button id="searchButton">Найти</button>
        </div>
      </div>

      <div class="articles-filter">
        <label for="sortSelect">Сортировка:</label>
        <select id="sortSelect">
          <option value="newest">Сначала новые</option>
          <option value="oldest">Сначала старые</option>
          <option value="title">По названию</option>
        </select>
      </div>

      <div id="articlesList" class="articles-list">
        <!-- Статьи будут загружаться здесь через JavaScript -->
        <div class="loading-message">Загрузка статей...</div>
      </div>

      <div class="pagination">
        <button id="prevPage" disabled>Назад</button>
        <span id="pageInfo">Страница 1</span>
        <button id="nextPage">Вперед</button>
      </div>
    </section>
  </main>
  <footer>
    <p>&copy; 2023 Платформа научных публикаций. Все права защищены.</p>
  </footer>

  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Загрузка статей при открытии страницы
      loadArticles();

      // Обработчики событий
      document.getElementById('searchButton').addEventListener('click', loadArticles);
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') loadArticles();
      });
      document.getElementById('sortSelect').addEventListener('change', loadArticles);
      document.getElementById('prevPage').addEventListener('click', function() {
        currentPage--;
        loadArticles();
      });
      document.getElementById('nextPage').addEventListener('click', function() {
        currentPage++;
        loadArticles();
      });

      // Переменные для пагинации
      let currentPage = 1;
      const articlesPerPage = 5;

      // Функция загрузки статей
      function loadArticles() {
        const searchQuery = document.getElementById('searchInput').value;
        const sortBy = document.getElementById('sortSelect').value;
        
        // Показываем индикатор загрузки
        document.getElementById('articlesList').innerHTML = 
          '<div class="loading-message">Загрузка статей...</div>';

        // Формируем URL для запроса
        let url = `${API_BASE}/api/articles?page=${currentPage}&limit=${articlesPerPage}`;
        if (searchQuery) url += `&q=${encodeURIComponent(searchQuery)}`;
        if (sortBy) url += `&sort=${sortBy}`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.error) throw new Error(data.error);
            
            // Отображаем статьи
            if (data.articles.length === 0) {
              document.getElementById('articlesList').innerHTML = 
                '<div class="no-articles">Статьи не найдены</div>';
              return;
            }

            const articlesHTML = data.articles.map(article => `
              <article class="article-preview">
                <h3><a href="article.html?id=${article.id}">${article.title}</a></h3>
                <div class="article-meta">
                  <span class="author">Автор: ${article.author}</span>
                  <span class="date">${new Date(article.created_at).toLocaleDateString()}</span>
                </div>
                <div class="article-content">
                  <p class="abstract">${article.abstract}</p>
                  <div class="keywords">Ключевые слова: ${article.keywords}</div>
                </div>
                <a href="article.html?id=${article.id}" class="read-more">Читать полностью →</a>
              </article>
            `).join('');

            document.getElementById('articlesList').innerHTML = articlesHTML;

            // Обновляем пагинацию
            document.getElementById('pageInfo').textContent = 
              `Страница ${currentPage} из ${Math.ceil(data.totalCount / articlesPerPage)}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = 
              currentPage === Math.ceil(data.totalCount / articlesPerPage);
          })
          .catch(error => {
            console.error('Ошибка загрузки статей:', error);
            document.getElementById('articlesList').innerHTML = 
              `<div class="error-message">Ошибка загрузки: ${error.message}</div>`;
          });
      }
    });
  </script>
</body>
</html>